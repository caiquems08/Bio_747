---
title: "Homework - week 2"
author: "Caique Machado, Pedro Henrique e Victor Signorini"
date: "`r Sys.Date()`"
output:
  html_document: default
  word_document: default
  pdf_document: default
editor_options:
  chunk_output_type: console
---
Atividade: i) Compute the prevalence types of SNP, ii) Compute the genomic relationship matrix using VanRaden’s method, iii) Estimate the minor allele frequency (MAF) and missing data. This can be done in groups of 3 students.

# Carregando Pacotes

```{r}
library(data.table)
library(dplyr)
library(questionr)
library(AGHmatrix)
```

# Carregando dados

```{r}

data <- fread("GSE50558_CFD_matrix_GEO.txt")

```

# Selecionando População

Vamos utilizar a população CFD01

```{r}
Pop_CFD01 <- data %>% 
  select(starts_with("CFD01")) %>% 
  select(ends_with("Alleles"))

head(Pop_CFD01)[,1:3]
```

# Computando SNPs prevalescentes

```{r}
AA <- length(which("AA" == Pop_CFD01))

AA

CC <- length(which("CC" == Pop_CFD01))

CC

GG <- length(which("GG" == Pop_CFD01))

GG

TT <- length(which("TT" == Pop_CFD01))

TT
```
Há uma prevalescência das bases Adenina e Guanina. Logo, o SNP prevalescente é A/G

# Codificando os SNPs

```{r}

Pop_CFD01 <- as.data.frame(apply(Pop_CFD01, 2, function(x) {x[x=="--"] <- NA ; x})) # Substituindo -- por NA

freq_SNPs <- apply(Pop_CFD01, 1, freq) # Lista com aas frequeências dos SNPs

maior_freq <- matrix (NA, nrow(Pop_CFD01), 1) # Criando objeto vazio para guardar a saída do loop

for (i in 1:nrow(Pop_CFD01)){
  maior_freq[i,] <- row.names(freq_SNPs[[i]][order(freq_SNPs[[i]]$n,
                                                   decreasing = TRUE),])[1]
}

SNPs_code <- apply(Pop_CFD01, 2, function (x) {x[x == maior_freq] <- "2" ; x}) # Codificando os alelos mais frequentes

SNPs_code <- apply(SNPs_code, 2, function (x) {x[!(x %in% c(2,NA))] <- "0"; x}) # Codificando os alelos menos frequentes

head(SNPs_code)[,1:3]

```

# MAF

```{r message=FALSE}
maf <- matrix(NA, nrow(SNPs_code), 1) # Objeto vazio para guardar a saída do loop

for (i in 1:nrow(SNPs_code)){
  freq <- table(SNPs_code[i,])
       maf[i,]<-min(freq)/sum(freq)
}

min(maf) #frequência do alelo menos frequente

```

# Dados perdidos

```{r}
freq(SNPs_code)
```
A proporção de dados perdidos (NA) é 15.5% 

# Matriz de Relacionamento Genômico

```{r}
SNPs_code <- apply(SNPs_code, 1, as.numeric)

gr_matrix <- Gmatrix(SNPs_code, method="VanRaden", missingValue = NA, maf=0.01, thresh.missing = 0.1) # A matriz de relacionamento genômico foi computada considerando uma frequência do alelo menos frequente (MAF) igual a 0.01 e uma proporção de dados perdidos igual a 10%

head(gr_matrix)[,1:5]


```


